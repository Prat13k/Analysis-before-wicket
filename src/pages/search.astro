---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogCard from '../components/BlogCard.astro';
import prisma from '../lib/database';

// Get search query
const query = Astro.url.searchParams.get('q') || '';

// Search blogs when query is provided
let blogs = [];
let hasResults = false;

if (query) {
  blogs = await prisma.blog.findMany({
    where: {
      OR: [
        { title: { contains: query, mode: 'insensitive' } },
        { description: { contains: query, mode: 'insensitive' } },
        { content: { contains: query, mode: 'insensitive' } },
        { country1: { contains: query, mode: 'insensitive' } },
        { country2: { contains: query, mode: 'insensitive' } }
      ]
    },
    orderBy: {
      publishedAt: 'desc'
    }
  });
  
  hasResults = blogs.length > 0;
}
---

<BaseLayout title="Search Results">
  <div class="container mx-auto py-12 px-4">
    <h1 class="text-3xl font-bold mb-2">Search Results</h1>
    {query && <p class="text-gray-600 mb-8">Showing results for: "{query}"</p>}
    
    {!query ? (
      <div class="text-center py-16 text-gray-500">
        <p class="text-xl">Enter a search term to find blogs</p>
      </div>
    ) : hasResults ? (
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        {blogs.map(blog => (
          <BlogCard blog={blog} />
        ))}
      </div>
    ) : (
      <div class="text-center py-16 text-gray-500">
        <p class="text-xl">No results found for "{query}"</p>
        <a href="/" class="text-green-800 hover:text-green-900 font-medium mt-4 inline-block">
          Return to homepage
        </a>
      </div>
    )}
  </div>
</BaseLayout>